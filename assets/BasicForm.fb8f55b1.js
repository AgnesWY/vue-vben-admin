var Le=Object.defineProperty;var Ae=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var ve=(e,i,n)=>i in e?Le(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n,T=(e,i)=>{for(var n in i||(i={}))Pe.call(i,n)&&ve(e,n,i[n]);if(Ae)for(var n of Ae(i))Me.call(i,n)&&ve(e,n,i[n]);return e};var D=(e,i,n)=>new Promise((r,p)=>{var f=d=>{try{l(n.next(d))}catch(m){p(m)}},c=d=>{try{l(n.throw(d))}catch(m){p(m)}},l=d=>d.done?r(d.value):Promise.resolve(d.value).then(f,c);l((n=n.apply(e,i)).next())});import{bi as Ne,bh as ke,a as Te,cW as _e,cX as xe,aE as B,f as _,au as Ce,c as ze,aw as z,o as q,j as X,z as x,i as Ye,n as ce,aA as Y,ax as Q,B as ue,t as fe,l as ae,bm as He,aB as ie,br as H,cY as ee,av as le,k as o,aF as re,cZ as te,c_ as K,c$ as pe,ah as G,aL as We,cR as Ue,a7 as Z,d0 as qe,cz as Ge,bt as De,bq as Xe,al as he,am as ge,d1 as Be,d2 as Fe,d3 as Ve,d4 as Ke,L as Je,w as we,v as J,b as Ze,N as Qe,h as et,az as de,F as tt,ay as Oe,aC as me,D as nt}from"./index.8b3a4968.js";/* empty css              *//* empty css              */import{d as ot,h as st,a as je,_ as at}from"./FormItem.vue_vue_type_script_lang.ff8bc7ae.js";import"./index.796fea7a.js";import{F as $e}from"./Form.d11d3df6.js";import{C as Ie}from"./index.af9de7bc.js";import{u as it}from"./uniqBy.d2a5c5e3.js";import{u as rt}from"./index.07f15dab.js";import{R as ct}from"./index.0b814ffd.js";const Ee=Symbol();function lt(e){return ke(e,Ee)}function ut(){return Ne(Ee)}const ft=Te({name:"BasicFormAction",components:{FormItem:$e.Item,Button:_e,BasicArrow:xe,[Ie.name]:Ie},props:{showActionButtonGroup:B.bool.def(!0),showResetButton:B.bool.def(!0),showSubmitButton:B.bool.def(!0),showAdvancedButton:B.bool.def(!0),resetButtonOptions:{type:Object,default:()=>({})},submitButtonOptions:{type:Object,default:()=>({})},actionColOptions:{type:Object,default:()=>({})},actionSpan:B.number.def(6),isAdvanced:B.bool,hideAdvanceBtn:B.bool},emits:["toggle-advanced"],setup(e,{emit:i}){const{t:n}=ze(),r=_(()=>{const{showAdvancedButton:l,actionSpan:d,actionColOptions:m}=e,v=24-d,w=l?{span:v<6?24:v}:{};return T(T({style:{textAlign:"right"},span:l?6:4},w),m)}),p=_(()=>Object.assign({text:n("common.resetText")},e.resetButtonOptions)),f=_(()=>Object.assign({text:n("common.queryText")},e.submitButtonOptions));function c(){i("toggle-advanced")}return T({t:n,actionColOpt:r,getResetBtnOptions:p,getSubmitBtnOptions:f,toggleAdvanced:c},ut())}});function dt(e,i,n,r,p,f){const c=z("Button"),l=z("BasicArrow"),d=z("FormItem"),m=z("a-col");return e.showActionButtonGroup?(q(),X(m,ie(Q({key:0},e.actionColOpt)),{default:x(()=>[Ye("div",{style:He([{width:"100%"},{textAlign:e.actionColOpt.style.textAlign}])},[ce(d,null,{default:x(()=>[Y(e.$slots,"resetBefore"),e.showResetButton?(q(),X(c,Q({key:0,type:"default",class:"mr-2"},e.getResetBtnOptions,{onClick:e.resetAction}),{default:x(()=>[ue(fe(e.getResetBtnOptions.text),1)]),_:1},16,["onClick"])):ae("",!0),Y(e.$slots,"submitBefore"),e.showSubmitButton?(q(),X(c,Q({key:1,type:"primary",class:"mr-2"},e.getSubmitBtnOptions,{onClick:e.submitAction}),{default:x(()=>[ue(fe(e.getSubmitBtnOptions.text),1)]),_:1},16,["onClick"])):ae("",!0),Y(e.$slots,"advanceBefore"),e.showAdvancedButton&&!e.hideAdvanceBtn?(q(),X(c,{key:2,type:"link",size:"small",onClick:e.toggleAdvanced},{default:x(()=>[ue(fe(e.isAdvanced?e.t("component.form.putAway"):e.t("component.form.unfold"))+" ",1),ce(l,{class:"ml-1",expand:!e.isAdvanced,up:""},null,8,["expand"])]),_:1},8,["onClick"])):ae("",!0),Y(e.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):ae("",!0)}var mt=Ce(ft,[["render",dt]]);function pt(e,i,n){const r=/^\[(.+)\]$/;if(r.test(e)){const p=e.match(r);if(p&&p[1]){const f=p[1].split(",");return i=Array.isArray(i)?i:[i],f.forEach((c,l)=>{te(n,c.trim(),i[l])}),!0}}}function ht(e,i,n){const r=/^\{(.+)\}$/;if(r.test(e)){const p=e.match(r);if(p&&p[1]){const f=p[1].split(",");return i=H(i)?i:{},f.forEach(c=>{te(n,c.trim(),i[c.trim()])}),!0}}}function bt({defaultValueRef:e,getSchema:i,formModel:n,getProps:r}){function p(l){var m,v;if(!H(l))return{};const d={};for(const w of Object.entries(l)){let[,s]=w;const[$]=w;if(!$||ee(s)&&s.length===0||le(s))continue;const V=o(r).transformDateFunc;H(s)&&(s=V==null?void 0:V(s)),ee(s)&&((m=s[0])==null?void 0:m.format)&&((v=s[1])==null?void 0:v.format)&&(s=s.map(P=>V==null?void 0:V(P))),re(s)&&(s===""?s=void 0:s=s.trim()),!pt($,s,d)&&!ht($,s,d)&&te(d,$,s)}return f(d)}function f(l){const d=o(r).fieldMapToTime;if(!d||!Array.isArray(d))return l;for(const[m,[v,w],s="YYYY-MM-DD"]of d){if(!m||!v||!w)continue;if(!l[m]){Reflect.deleteProperty(l,m);continue}const[$,V]=l[m],[P,b]=Array.isArray(s)?s:[s,s];l[v]=K($).format(P),l[w]=K(V).format(b),Reflect.deleteProperty(l,m)}return l}function c(){const l=o(i),d={};l.forEach(m=>{const{defaultValue:v}=m;pe(v)||(d[m.field]=v,n[m.field]===void 0&&(n[m.field]=v))}),e.value=G(d)}return{handleFormValues:p,initDefault:c}}const U=24;function yt({advanceState:e,emit:i,getProps:n,getSchema:r,formModel:p,defaultValueRef:f}){const c=We(),{realWidthRef:l,screenEnum:d,screenRef:m}=Ue(),v=_(()=>{if(!e.isAdvanced)return 0;const b=o(n).emptySpan||0;if(Ge(b))return b;if(H(b)){const{span:F=0}=b,M=o(m);return b[M.toLowerCase()]||F||0}return 0}),w=De(V,30);Z([()=>o(r),()=>e.isAdvanced,()=>o(l)],()=>{const{showAdvancedButton:b}=o(n);b&&w()},{immediate:!0});function s(b,F=0,M=!1){const S=o(l),E=parseInt(b.md)||parseInt(b.xs)||parseInt(b.sm)||b.span||U,j=parseInt(b.lg)||E,N=parseInt(b.xl)||j,t=parseInt(b.xxl)||N;return S<=d.LG?F+=E:S<d.XL?F+=j:S<d.XXL?F+=N:F+=t,M?(e.hideAdvanceBtn=!1,F<=U*2?(e.hideAdvanceBtn=!0,e.isAdvanced=!0):F>U*2&&F<=U*(o(n).autoAdvancedLine||3)?e.hideAdvanceBtn=!1:e.isLoad||(e.isLoad=!0,e.isAdvanced=!e.isAdvanced),{isAdvanced:e.isAdvanced,itemColSum:F}):F>U*(o(n).alwaysShowLines||1)?{isAdvanced:e.isAdvanced,itemColSum:F}:{isAdvanced:!0,itemColSum:F}}const $=qe({});function V(){var S;let b=0,F=0;const{baseColProps:M={}}=o(n);for(const E of o(r)){const{show:j,colProps:N}=E;let t=!0;if(Xe(j)&&(t=j),le(j)&&(t=j({schema:E,model:p,field:E.field,values:T(T({},o(f)),p)})),t&&(N||M)){const{itemColSum:a,isAdvanced:g}=s(T(T({},M),N),b);b=a||0,g&&(F=b),$[E.field]=g}}(S=c==null?void 0:c.proxy)==null||S.$forceUpdate(),e.actionSpan=F%U+o(v),s(o(n).actionColOptions||{span:U},b,!0),i("advanced-change")}function P(){e.isAdvanced=!e.isAdvanced}return{handleToggleAdvanced:P,fieldsIsAdvancedMap:$}}function At(e,i={}){const n=/^\[(.+)\]$/;if(n.test(e)){const r=e.match(n);if(r&&r[1]){const p=r[1].split(",");if(!p.length)return;const f=[];return p.forEach((c,l)=>{te(f,l,i[c.trim()])}),f.length?f:void 0}}}function vt(e,i={}){const n=/^\{(.+)\}$/;if(n.test(e)){const r=e.match(n);if(r&&r[1]){const p=r[1].split(",");if(!p.length)return;const f={};return p.forEach(c=>{te(f,c.trim(),i[c.trim()])}),Object.values(f).filter(Boolean).length?f:void 0}}}function gt({emit:e,getProps:i,formModel:n,getSchema:r,defaultValueRef:p,formElRef:f,schemaRef:c,handleFormValues:l}){function d(){return D(this,null,function*(){const{resetFunc:t,submitOnReset:a}=o(i);t&&le(t)&&(yield t()),o(f)&&(Object.keys(n).forEach(u=>{const h=o(r).find(W=>W.field===u),A=(h==null?void 0:h.component)&&ot.includes(h.component),C=G(p.value[u]);n[u]=A?C||"":C}),he(()=>E()),e("reset",ge(n)),a&&N())})}function m(t){return D(this,null,function*(){const a=o(r).map(A=>A.field).filter(Boolean),g=".",u=a.filter(A=>String(A).indexOf(g)>=0),h=[];a.forEach(A=>{const C=o(r).find(O=>O.field===A);let W=t[A];const ne=Reflect.has(t,A);W=st(C==null?void 0:C.component,W);const{componentProps:oe}=C||{};let R=oe;typeof oe=="function"&&(R=R({formModel:o(n)}));const se=At(A,t)||vt(A,t);if(ne||!!se){const O=se||W;if(F(A))if(Array.isArray(O)){const k=[];for(const y of O)k.push(y?K(y):null);o(n)[A]=k}else o(n)[A]=O?R!=null&&R.valueFormat?O:K(O):null;else o(n)[A]=O;R!=null&&R.onChange&&(R==null||R.onChange(O)),h.push(A)}else u.forEach(O=>{try{const k=O.split(".").reduce((y,I)=>y[I],t);Be(k)&&(o(n)[O]=o(k),h.push(O))}catch(k){Be(p.value[O])&&(o(n)[O]=G(o(p.value[O])))}})}),M(h).catch(A=>{})})}function v(t){return D(this,null,function*(){const a=G(o(r));if(!t)return;let g=re(t)?[t]:t;re(t)&&(g=[t]);for(const u of g)w(u,a);c.value=a})}function w(t,a){if(re(t)){const g=a.findIndex(u=>u.field===t);g!==-1&&(delete n[t],a.splice(g,1))}}function s(t,a,g=!1){return D(this,null,function*(){const u=G(o(r)),h=u.findIndex(C=>C.field===a),A=H(t)?[t]:t;if(!a||h===-1||g){g?u.unshift(...A):u.push(...A),c.value=u,P(t);return}h!==-1&&u.splice(h+1,0,...A),P(t),c.value=u})}function $(t){return D(this,null,function*(){let a=[];if(H(t)&&a.push(t),ee(t)&&(a=[...t]),!a.every(u=>u.component==="Divider"||Reflect.has(u,"field")&&u.field)){Fe("All children of the form Schema array that need to be updated must contain the `field` field");return}c.value=a})}function V(t){return D(this,null,function*(){let a=[];if(H(t)&&a.push(t),ee(t)&&(a=[...t]),!a.every(h=>h.component==="Divider"||Reflect.has(h,"field")&&h.field)){Fe("All children of the form Schema array that need to be updated must contain the `field` field");return}const u=[];o(r).forEach(h=>{let A;if(a.forEach(C=>{h.field===C.field&&(A=C)}),A!==void 0&&h.field===A.field){const C=Ve(h,A);u.push(C)}else u.push(h)}),P(u),c.value=it(u,"field")})}function P(t){let a=[];H(t)&&a.push(t),ee(t)&&(a=[...t]);const g={},u=b();a.forEach(h=>{h.component!="Divider"&&Reflect.has(h,"field")&&h.field&&!pe(h.defaultValue)&&(!(h.field in u)||pe(u[h.field])||Ke(u[h.field]))&&(g[h.field]=h.defaultValue)}),m(g)}function b(){return o(f)?l(ge(o(n))):{}}function F(t){return o(r).some(a=>a.field===t?je.includes(a.component):!1)}function M(t){return D(this,null,function*(){var a;return(a=o(f))==null?void 0:a.validateFields(t)})}function S(t){return D(this,null,function*(){var a;return yield(a=o(f))==null?void 0:a.validate(t)})}function E(t){return D(this,null,function*(){var a;yield(a=o(f))==null?void 0:a.clearValidate(t)})}function j(t,a){return D(this,null,function*(){var g;yield(g=o(f))==null?void 0:g.scrollToField(t,a)})}function N(t){return D(this,null,function*(){t&&t.preventDefault();const{submitFunc:a}=o(i);if(a&&le(a)){yield a();return}if(!!o(f))try{const u=yield S(),h=l(u);e("submit",h)}catch(u){if((u==null?void 0:u.outOfDate)===!1&&(u==null?void 0:u.errorFields))return;throw new Error(u)}})}return{handleSubmit:N,clearValidate:E,validate:S,validateFields:M,getFieldsValue:b,updateSchema:V,resetSchema:$,appendSchemaByField:s,removeSchemaByField:v,resetFields:d,setFieldsValue:m,scrollToField:j}}function Bt(p){return D(this,arguments,function*({getSchema:e,getProps:i,formElRef:n,isInitedDefault:r}){Je(()=>D(this,null,function*(){if(o(r)||!o(i).autoFocusFirstItem)return;yield he();const f=o(e),c=o(n),l=c==null?void 0:c.$el;if(!c||!l||!f||f.length===0||!f[0].component.includes("Input"))return;const m=l.querySelector(".ant-row:first-child input");!m||m==null||m.focus()}))})}const Ft={model:{type:Object,default:()=>({})},labelWidth:{type:[Number,String],default:0},fieldMapToTime:{type:Array,default:()=>[]},compact:B.bool,schemas:{type:Array,default:()=>[]},mergeDynamicData:{type:Object,default:null},baseRowStyle:{type:Object},baseColProps:{type:Object},autoSetPlaceHolder:B.bool.def(!0),autoSubmitOnEnter:B.bool.def(!1),submitOnReset:B.bool,submitOnChange:B.bool,size:B.oneOf(["default","small","large"]).def("default"),disabled:B.bool,emptySpan:{type:[Number,Object],default:0},showAdvancedButton:B.bool,transformDateFunc:{type:Function,default:e=>{var i,n;return(n=(i=e==null?void 0:e.format)==null?void 0:i.call(e,"YYYY-MM-DD HH:mm:ss"))!=null?n:e}},rulesMessageJoinLabel:B.bool.def(!0),autoAdvancedLine:B.number.def(3),alwaysShowLines:B.number.def(1),showActionButtonGroup:B.bool.def(!0),actionColOptions:Object,showResetButton:B.bool.def(!0),autoFocusFirstItem:B.bool,resetButtonOptions:Object,showSubmitButton:B.bool.def(!0),submitButtonOptions:Object,resetFunc:Function,submitFunc:Function,hideRequiredMark:B.bool,labelCol:Object,layout:B.oneOf(["horizontal","vertical","inline"]).def("horizontal"),tableAction:{type:Object},wrapperCol:Object,colon:B.bool,labelAlign:B.string,rowProps:Object};const wt=Te({name:"BasicForm",components:{FormItem:at,Form:$e,Row:ct,FormAction:mt},props:Ft,emits:["advanced-change","reset","submit","register","field-value-change"],setup(e,{emit:i,attrs:n}){const r=we({}),p=rt(),f=we({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),c=J({}),l=J(!1),d=J({}),m=J(null),v=J(null),{prefixCls:w}=Ze("basic-form"),s=_(()=>T(T({},e),o(d))),$=_(()=>[w,{[`${w}--compact`]:o(s).compact}]),V=_(()=>{const{baseRowStyle:y={},rowProps:I}=o(s);return T({style:y},I)}),P=_(()=>T(T(T({},n),e),o(s))),b=_(()=>{const y=o(m)||o(s).schemas;for(const I of y){const{defaultValue:L,component:be,isHandleDateDefaultValue:Re=!0}=I;if(Re&&L&&je.includes(be))if(!Array.isArray(L))I.defaultValue=K(L);else{const ye=[];L.forEach(Se=>{ye.push(K(Se))}),I.defaultValue=ye}}return o(s).showAdvancedButton?G(y.filter(I=>I.component!=="Divider")):G(y)}),{handleToggleAdvanced:F,fieldsIsAdvancedMap:M}=yt({advanceState:f,emit:i,getProps:s,getSchema:b,formModel:r,defaultValueRef:c}),{handleFormValues:S,initDefault:E}=bt({getProps:s,defaultValueRef:c,getSchema:b,formModel:r});Bt({getSchema:b,getProps:s,isInitedDefault:l,formElRef:v});const{handleSubmit:j,setFieldsValue:N,clearValidate:t,validate:a,validateFields:g,getFieldsValue:u,updateSchema:h,resetSchema:A,appendSchemaByField:C,removeSchemaByField:W,resetFields:ne,scrollToField:oe}=gt({emit:i,getProps:s,formModel:r,getSchema:b,defaultValueRef:c,formElRef:v,schemaRef:m,handleFormValues:S});lt({resetAction:ne,submitAction:j}),Z(()=>o(s).model,()=>{const{model:y}=o(s);!y||N(y)},{immediate:!0}),Z(()=>o(s).schemas,y=>{A(y!=null?y:[])}),Z(()=>b.value,y=>{he(()=>{var I;(I=p==null?void 0:p.redoModalHeight)==null||I.call(p)}),!o(l)&&y!=null&&y.length&&(E(),l.value=!0)}),Z(()=>r,De(()=>{o(s).submitOnChange&&j()},300),{deep:!0});function R(y){return D(this,null,function*(){d.value=Ve(o(d)||{},y)})}function se(y,I,L){r[y]=I,i("field-value-change",y,I),L&&L.itemProps&&!L.itemProps.autoLink&&g([y]).catch(be=>{})}function O(y){const{autoSubmitOnEnter:I}=o(s);if(!!I&&y.key==="Enter"&&y.target&&y.target instanceof HTMLElement){const L=y.target;L&&L.tagName&&L.tagName.toUpperCase()=="INPUT"&&j()}}const k={getFieldsValue:u,setFieldsValue:N,resetFields:ne,updateSchema:h,resetSchema:A,setProps:R,removeSchemaByField:W,appendSchemaByField:C,clearValidate:t,validateFields:g,validate:a,submit:j,scrollToField:oe};return Qe(()=>{E(),i("register",k)}),T({getBindValue:P,handleToggleAdvanced:F,handleEnterPress:O,formModel:r,defaultValueRef:c,advanceState:f,getRow:V,getProps:s,formElRef:v,getSchema:b,formActionType:k,setFormModel:se,getFormClass:$,getFormActionBindProps:_(()=>T(T({},s.value),f)),fieldsIsAdvancedMap:M},k)}});function Ot(e,i,n,r,p,f){const c=z("FormItem"),l=z("FormAction"),d=z("Row"),m=z("Form");return q(),X(m,Q(e.getBindValue,{class:e.getFormClass,ref:"formElRef",model:e.formModel,onKeypress:nt(e.handleEnterPress,["enter"])}),{default:x(()=>[ce(d,ie(me(e.getRow)),{default:x(()=>[Y(e.$slots,"formHeader"),(q(!0),et(tt,null,de(e.getSchema,v=>(q(),X(c,{key:v.field,isAdvanced:e.fieldsIsAdvancedMap[v.field],tableAction:e.tableAction,formActionType:e.formActionType,schema:v,formProps:e.getProps,allDefaultValues:e.defaultValueRef,formModel:e.formModel,setFormModel:e.setFormModel},Oe({_:2},[de(Object.keys(e.$slots),w=>({name:w,fn:x(s=>[Y(e.$slots,w,ie(me(s||{})))])}))]),1032,["isAdvanced","tableAction","formActionType","schema","formProps","allDefaultValues","formModel","setFormModel"]))),128)),ce(l,Q(e.getFormActionBindProps,{onToggleAdvanced:e.handleToggleAdvanced}),Oe({_:2},[de(["resetBefore","submitBefore","advanceBefore","advanceAfter"],v=>({name:v,fn:x(w=>[Y(e.$slots,v,ie(me(w||{})))])}))]),1040,["onToggleAdvanced"]),Y(e.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"])}var Pt=Ce(wt,[["render",Ot]]);export{Pt as B};
